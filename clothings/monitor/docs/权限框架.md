
# 移动APP安全网关设计

## 前言

目前移动APP铺天盖地，移动网关也是必备的系统。这里主要介绍移动安全网关设计，报文安全无非就是解决三个问题：防窃取、防篡改、防抵赖。下面就如何解决这三个问题给出具体的方案。

## 1 防抵赖

先从最简单的说起，防抵赖是最简单的，就是通过双方签名来防抵赖。实现双方签名就需要两套密钥，一套是客户端公私钥，一套是网关公私钥。在客户端保存客户端私钥(CK-private)和网关端公钥(SK-public)，网关端保存客户端公钥(CK-public)和网关端私钥(SK-private)。

整个过程中，双方一旦校验成功，就对双方的交易不能抵赖。因为报文的签名都是用各自的私钥签名，其他人无法仿照签名发起交易。

**安全问题**：整个方案的前提是客户端私钥、服务端私钥没有泄露。客户端如何安全保存私钥呢在安全文章中将会详解。服务端私钥存储大公司会保存在加密机中，小公司会就直接硬编码到代码中。

**加密方式**：非对称（RSA、SM2）、散列算法（MD5、SHA1）


## 2 防篡改

通过防抵赖的技术可以做到防篡改，因为如果报文被篡改了，那么交易签名一定会验证失败。

## 3 防窃取

很多APP报文中没有敏感信息，所以没有做防窃取保护。https如果没有做双向认证，也很容易被中间人攻击。很多金融类APP和网关之间都做了应用层的加密来防止报文被窃取。下面重点介绍如何做到报文防窃取。

报文防窃取最主要就是做到报文加密，加密分为对称加密和非对称加密。**对称加解密和非对称加解密的性能差异是巨大的，对称加密的性能是非对称的几十倍**，所以对于单纯的报文一般用对称加密，常用的对称加密算法有**AES、3DES**，但对称加密的安全性较低，一旦对称密钥被窃取，整个报文加密体系将会被攻破。业界一般会对对称密钥定期更新。

### 3.1 传统报文加密方式

传统做法是客户端和服务端都保存对称密钥、使用对称加密算法进行加密。对于一般交易可以保证性能和安全性，客户端一定要保存好对称密钥。同时需要密钥定时更新体系，能够做到定期自动更新。

- **加密**：对称加密一般通过3DES、AES算法实现，各语言也均有实现，也可以通过加密机使用加密指令来加密。
- **密钥更新**：通过非对称加密对称密钥来进行密钥传输，服务端使用服务端私钥加密对称密钥，客户端使用服务端公钥解密获取对称密钥。


**安全问题**：密钥存储。

### 3.2 一机一密

### 3.3 动态密钥库

