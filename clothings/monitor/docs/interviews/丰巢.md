
# 丰巢 Interview Record #

- dubbo 服务升级
- dubbo 路由功能
- dubbo 过滤器
- dubbo 限流
- dubbo 服务降级
- Dubbo服务治理之灰度发布方案
- dubbo 动态限流
- dubbo 序列化
- MYSQL优化
- ES为什么延迟，数据会丢失吗
- 避免缓存雪崩和穿透
- 怎么做到动态分布式限流
- CMS和G1的区别
- 怎么预防接口被攻击


## 1 dubbo 服务升级

当一个接口出现不兼容升级时，可以用版本号过度，版本号不同的服务互相间不引用。可以按照以下步骤进行迁移：

- 0. 在低压力时候，先升级一半的提供者为新版本
- 1. 再将所有消费者升级为新版本
- 2. 再将剩余提供者升级为新版本


## Dubbo服务治理之灰度发布方案

客户端在发起RPC服务调用之前，在客户端首先从服务器列表中选择一个服务提供者，包含如下关键角色：

- 1 Directory:服务的动态发现、通常基于注册中心进行服务的动态注册和发现，其具体实现类为RegisterDirectory
- 2 Router:根据Directory发现的服务列表，进行路由选择。也就是根据路由规则选择合适的提供者，为Directory发现服务列表的子集，可以基于Condition和JS脚本
- 3 Loadbalance:随机权重、轮询权重。从router后的列表中选择一个进行本次RPC调用
- 4 Cluster：集群容错机制。

服务灰度发布：其目标是希望根据请求，某些请求走新版本服务器，某些走旧版本，其本质是路由机制，通过路由缩小提供者列表。

路由规则示例：

- 0. 排除预发布机：即所有请求都不要发送到某台预发布机，  => host != xxx.xxx.xx.xxx
- 1. 只暴露一部分机器,防止整个集群挂掉，  => host = 192.168.1.*,192.168.2.*
- 2. 读写分离：
	* method = find*,list*,get* => host = 192.168.1.110,192.168.1.111,192.168.1.112
	* method != find*,list*,get* => host = 192.168.1.116,192.168.1.116


## MYSQL优化

- 为每一个表创建一个Innodbfile,这样保证共享空间不会太大。
- 调大内存池，进行数据预热，保证从内存里读取数据。
- 每次重启数据库，或整库备份前进行数据预热
- 定期重建优化数据结构
- 降低磁盘写操作

