
# Redis #

- 项目中如何使用缓存，为什么使用缓存
- 缓存使用不当回造成什么结果
- redis和memcached区别
- redis线程模型
- 为什么redis单线程模型，却能支持高并发
- redis过期策略
- redis内存淘汰机制
- 手写一个LRU算法
- 如何保证 redis 的高并发和高可用
- redis 的主从复制原理能介绍一下么
- redis 的哨兵原理能介绍一下么

## 项目中如何使用缓存，为什么使用缓存 ##

- 将EPC信息放入缓存，商品信息放入缓存。
- 提高性能，缓存秩序几毫秒，而查数据库需要上百毫秒

## 缓存使用不当回造成什么结果 ##

## redis和memcached区别 ##

### redis支持更丰富的数据结构 ###
	redis支持如下结构
- string/list/hash/set/zset

### redis原生支持集群模式 ###

### 性能对比 ###
- redis使用单核CPU：在存储小于100K的数据时，性能更高，而当大于100K时Memcache更强.

## redis线程模型 ##

- redis的命令处理是单线程模式, 处理连接请求，套接字读写事件，以及命令的解析和业务操作均在一个IO多路复用线程上。减少线程切换开销。
- 因为命令处理这块都是内存操作，若以响应较快。（但怎么持久化，APF的持久化也在这个线程吗，肯定不是）

## redis过期策略 ##

	 定期删除+惰性删除：
- 定期删除：是指，redis默认每个100ms会随机检查一些设置了过期时间的KEY，若过期就删除。定期删除会导致一个问题，很多已经过期了key没有及时删除。此时会有惰性删除来补充。
- 惰性删除：当查询某key时，若该key设置了过期时间，会判断是否过期，若过期就会删除。

## redis内存淘汰机制 ##
	虽然有过期删除机制，但还是会存在，大量过期key既没有轮训到定时删除，也没有触发惰性删除。此时内存快满了之后怎么处理？答案是走内存淘汰机制，内存淘汰机制有以下几种：
- allkeys-lru，当内存不够时，在键空间中，移除最近最少使用的key。(这个策略最常用) 	

## 手写一个LRU算法 ##

- 待思考

## 如何保证 redis 的高并发和高可用 ##

- redis 单机可以抗住几万并发的写入，利用主从模式，可以在从服务器抗住几十万的读QPS
- 避免使用大key，避免使用耗时较久的命令
- 可以哨兵机制保证redis的高可用

## redis 的主从复制原理 ##

- 主从架构的目的：分担读的压力，拓扑结构可以是一主多从，和级联结构, 主从复制又根据是否全量分为全量复制和增量同步。
- 原理介绍，操作步骤，注意事项

### 全量同步 ###
	全量同步一般发生在第一次建立主从架构的时候, 这时候slave需要将master上所有数据都复制一遍。具体步骤如下：
- 从服务器连接主服务器，发送Sync命令
- 主服务器接收到Sync命令后，开始执行bgsave命令，生成RDB文件，并使用缓冲区记录此后主服务器所有执行的写命令.  （监控生成RDB文件时间，监控发送缓冲区大小）
- 主服务器执行完后bgsave后，发送RDB文件给从服务器。
- 从服务器收到RDB文件后，丢弃所有旧的数据，开始加载新的RDB文件。
- 主服务器发送完成后，开始发送缓冲区命令
- 从服务器开始接受主服务器缓冲区的命令
- 完成上面操作后，从服务器可以接收读请求了

### 增量同步 ###

- 在完成全量后，从服务器开始正常工作，同时接收主服务器同步过来的命令
- 主从刚刚建立时，都会执行全量同步，结束后执行增量同步。
- 如果有需要，slave服务器可以在任何时候发起全量同步
- redis策略，无论如何，先判断是否可以增量同步。

### 注意点 ###

- 如果多个slave断了，重新连上，会开始重新同步（2.8之后会采用增量同步）,回导致master服务IO增加。

### 主从复制的几点重要内容 ###

- redis主从复制不阻塞主服务器
- redis主从复制，也不阻塞从服务器，当初始同步时，从服务器可以采用就数据来查询，也可以给从客户端返回错误.
- 使用主从配置可以在主服务器不保存，在从服务器上持久化数据，但是这个架构要注意主服务器不要自动重启。

## redis 的哨兵原理能介绍一下么 ##

- 哨兵模式概述
- 哨兵模式配置
- 哨兵模式其他配置项

### 哨兵模式概述 ###

	哨兵是一个独立的进程，通过定时向redis服务发送命令，来监控redis服务运行状态。当哨兵检测到主redis宕机后，哨兵会提升slave为master。同时通过发布订阅模式通知其他slave服务器，修改其主服务器配置.
	同时一个哨兵进程也会出现问题，可以启动多个哨兵进程，相互监控，即形成哨兵模式。
### 哨兵模式配置 ###

	在sentinel.conf文件中配置
- sentinel monitor mymaster 192.168.11.128 6379 2
- 意思是 监控192.168.11.128主服务器，端口为6379。给redis主机命名为mymaster。2 代表只有两个或2个以上认为主redis不可用时，才会进行故障转移。
- 启动顺序是：master  -->  slave  -->  sentinel