
# dubbo知识梳理

- dubbo 常用配置
- dubbo 集群容错机制
- dubbo 服务降级

### 1、什么是dubbo ###

	dubbo是远程接口调用框架，主要核心功能有：远程接口调用，负载均衡，服务自动注册与发现

### 2、为什么要用dubbo,而不直接用http接口通信 ###

- 负载均衡, 同一服务可以部署多个实例，调用时根据负载均衡机制，可以随意调用任意一个。http的负载均衡需要另外借助F5或lvs等其他外部方式
- 服务调用链生成
- 服务访问压力及时长统计，随时增减服务，提高资源利用率
- 服务降级

### 3、dubbo架构 ###

	dubbo包含以下几个节点：

- provider 服务提供方
- consumer 服务消费方
- monitor 监控中心，统计服务的调用次数，和调用时间的监控中心(可选,可以基于dubboAPI进行自定义开发)
- register 注册中心(使用zookeeper)

## dubbo 常用配置

- 负载均衡
- 线程模型

- 启动时检查：
	* service.check = false, 关闭某个接口的启动检查（没有提供者报错）
	* consumer.check = false, 关闭整个服务的检查
	* register.check = false,  关闭注册中心启动时检查
	
- 集群容错：在调用出错时，Dubbo提供了多种容错机制，缺省为failover重试。
	* failover：失败重试，通过配置retries设置重试次数，默认为2次，通常用于读操作，但是重试会带来更长的延迟
	* failfast: 快速失败，只发起一次调用，失败立即报错，多用于非幂等性的写接口，比如新增记录
	* failsalf: 失败安全，多用于日志操作，忽略失败
	* failback: 失败自动恢复，后台记录失败的请求，定时重发，多用于发送消息操作
	* forking: 并行调用多个服务，只要一个成功即返回，通常用于实时性要求较高的读操作
	* broadcast: 广播调用集群所有服务，逐个调用，若有一台报错则报错，通常用于通知提供者更新缓存、日志及本地资源信息等

#### 负载均衡

dubbo提供了很多负载均衡机制，默认使用random随机调用

- Random: 随机，按权重设置随机概率
- RoundRobin: 轮询，按公约后的权重设置轮询
- leastAction: 最少活跃数
- ConsistentHash: 一致性hash，相同参数的请求发到同一提供方。当一致性hash提供者挂了，就平均到其他提供方

#### 线程模型

如果迅速处理的逻辑能够迅速完成，并且不会发起新的IO请求，比如只是在内存操作，则直接在IO线程上处理更快，因为减少了线程池上调度。

但如果事件处理逻辑较慢，或者发起新的IO请求，比如查询数据库，则必须派发到线程池。否则IO线程将阻塞，不能接收其他请求。

因此需要由不同的派发策略和不同的线程池配置的组合来应对不同场景。

Dispatch(派发策略)

- all: 默认配置，所有消息都派发到线程池，包括请求、响应、IO断开与连接，心跳等事件。
- direct：所有消息都直接在IO线程池上处理
- message：只有消息的请求和响应派发到线程池，其他都在IO线程上执行




		
	
	
		



